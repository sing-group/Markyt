
/*!
 * jQuery MotionCAPTCHA v0.2
 * 
 * Proof of concept only for now, check the roadmap to see when it will be ready for wider use!
 * 
 * http://josscrowcroft.com/projects/motioncaptcha-jquery-plugin/
 * 
 * DEMO: http://josscrowcroft.com/demos/motioncaptcha/
 * CODE: https://github.com/josscrowcroft/MotionCAPTCHA
 * 
 * Copyright (c) 2011 Joss Crowcroft - joss[at]josscrowcroftcom | http://www.josscrowcroft.com
 * 
 * Incoporates other open source projects, attributed below.
 */
jQuery.fn.motionCaptcha||(function(h){h.fn.motionCaptcha=function(x){return this.each(function(){var F=h.extend({},h.fn.motionCaptcha.defaults,x);F.actionId="#"+F.actionId.replace(/\#/g,"");F.canvasId="#"+F.canvasId.replace(/\#/g,"");F.divId="#"+F.divId.replace(/\#/g,"");F.submitId=(F.submitId)?"#"+F.submitId.replace(/\#/g,""):false;var A,R=false;var H=h("body"),D=h(this),J=h(F.divId),E=h(F.canvasId);var O=E.width(),z=E.height(),y=1*E.css("borderLeftWidth").replace("px",""),L=1*E.css("borderTopWidth").replace("px","");E[0].width=O;E[0].height=z;var I=E[0].getContext("2d");I.canvasWidth=O;I.canvasHeight=z;I.font=F.canvasFont;I.fillStyle=F.canvasTextColor;E.addClass(F.shapes[Math.floor(Math.random()*(F.shapes.length))]);var P=false,B=false,C=[],Q=new l();A=new v(I);var N=function(T){if(R){return false}T.preventDefault();var V=K(T),S=V[0],U=V[1];P=true;B=true;h("body").addClass("mc-noselect");I.clearRect(0,0,O,z);A.strokeStart(S,U);E.removeClass("mc-invalid mc-valid");C=[n(S,U)];return false};var M=function(T){if(B){return B=0}if(!R&&P){T.preventDefault();var V=K(T),S=V[0],U=V[1];C[C.length]=n(S,U);A.stroke(S,U)}return false};var G=function(T){if(!R&&P){P=false;h("body").removeClass("mc-noselect");if(C.length>=10){var S=Q.Recognize(C);if(E.attr("class").match(S.Name)&&S.Score>0.7){R=1;setTimeout(A.destroy,500);E.addClass("mc-valid");I.fillText(F.successMsg,10,24);F.onSuccess(D,E,I)}else{E.addClass("mc-invalid");I.fillText(F.errorMsg,10,24);F.onError(D,E,I)}}else{E.addClass("mc-invalid");I.fillText(F.errorMsg,10,24);F.onError(D,E,I)}}return false};E.bind({mousedown:N,mousemove:M,mouseup:G,});E[0].addEventListener("touchstart",N,false);E[0].addEventListener("touchmove",M,false);E[0].addEventListener("touchend",G,false);D.addClass(F.cssClass.replace(/\./,""));function K(T){var S,U;if(T.touches&&T.touches.length>0){S=T.touches[0].pageX-E.offset().left+y;U=T.touches[0].pageY-E.offset().top+L}else{if(T.offsetX){S=T.offsetX-y;U=T.offsetY-L}else{S=T.pageX-E.offset().left-y;U=T.pageY-E.offset().top-L}}return[S,U]}})};h.fn.motionCaptcha.defaults={actionId:"#mc-action",divId:"#mc",canvasId:"#mc-canvas",submitId:false,cssClass:".mc-active",shapes:["triangle","x","rectangle","circle","check","caret","zigzag","arrow","leftbracket","rightbracket","v","delete","star","pigtail"],canvasFont:'15px "Lucida Grande"',canvasTextColor:"#111",errorMsg:"Please try again.",successMsg:"Captcha passed!",noCanvasMsg:"Your browser doesn't support <canvas> - try Chrome, FF4, Safari or IE9.",label:"<p>Please draw the shape in the box to submit the form:</p>",onSuccess:function(y,A,x){var z=this,B=z.submitId?y.find(z.submitId):y.find("input[type=submit]:disabled");y.attr("action",h(z.actionId).val());B.prop("disabled",false);return},onError:function(y,A,x){var z=this;return}};
/*!
	 * Harmony | mrdoob | Ribbon Brush class
	 * http://mrdoob.com/projects/harmony/
	 */
function v(x){this.init(x)}v.prototype={ctx:null,X:null,Y:null,painters:null,interval:null,init:function(x){var z=this,C=navigator.userAgent.toLowerCase(),A=(C.search("android")>-1||C.search("iphone")>-1)?2:1,B=[0,0,0];this.ctx=x;this.ctx.globalCompositeOperation="source-over";this.X=this.ctx.canvasWidth/2;this.Y=this.ctx.canvasHeight/2;this.painters=[];for(var y=0;y<38;y++){this.painters.push({dx:this.ctx.canvasWidth/2,dy:this.ctx.canvasHeight/2,ax:0,ay:0,div:0.1,ease:Math.random()*0.18+0.6})}this.interval=setInterval(D,1000/60);function D(){var E;z.ctx.lineWidth=A;z.ctx.strokeStyle="rgba("+B[0]+", "+B[1]+", "+B[2]+", "+0.06+")";for(E=0;E<z.painters.length;E++){z.ctx.beginPath();z.ctx.moveTo(z.painters[E].dx,z.painters[E].dy);z.painters[E].dx-=z.painters[E].ax=(z.painters[E].ax+(z.painters[E].dx-z.X)*z.painters[E].div)*z.painters[E].ease;z.painters[E].dy-=z.painters[E].ay=(z.painters[E].ay+(z.painters[E].dy-z.Y)*z.painters[E].div)*z.painters[E].ease;z.ctx.lineTo(z.painters[E].dx,z.painters[E].dy);z.ctx.stroke()}}},destroy:function(){clearInterval(this.interval)},strokeStart:function(z,y){this.X=z;this.Y=y;for(var x=0;x<this.painters.length;x++){this.painters[x].dx=z;this.painters[x].dy=y}this.shouldDraw=true},stroke:function(y,x){this.X=y;this.Y=x}};
/*!
	 * The $1 Unistroke Recognizer
	 * http://depts.washington.edu/aimgroup/proj/dollar/
	 * 
	 * Jacob O. Wobbrock, Ph.D. | wobbrock@u.washington.edu
	 * Andrew D. Wilson, Ph.D. | awilson@microsoft.com
	 * Yang Li, Ph.D. | yangli@cs.washington.edu
	 * 
	 * Modified to include the Protractor gesture recognizing algorithm
	 * http://www.yangl.org/pdf/protractor-chi2010.pdf
	 * 
	 * Adapted and modified for purpose by Joss Crowcroft
	 * http://www.josscrowcroft.com
	 * 
	 * The original software is distributed under the "New BSD License" agreement
	 * 
	 * Copyright (c) 2007-2011, Jacob O. Wobbrock, Andrew D. Wilson and Yang Li. All rights reserved.
	**/
function u(z,A){this.X=z;this.Y=A}function n(z,A){return new u(z,A)}function b(A,C,B,z){this.X=A;this.Y=C;this.Width=B;this.Height=z}function w(x,y){this.Name=x;this.Points=g(y,c);var z=o(this.Points);this.Points=k(this.Points,-z);this.Points=s(this.Points,r);this.Points=d(this.Points,t);this.Vector=q(this.Points)}function j(x,y){this.Name=x;this.Score=y}var i=16,c=64,r=250,t=n(0,0);function l(){this.Templates=[];this.Templates.push(new w("triangle",[n(137,139),n(135,141),n(133,144),n(132,146),n(130,149),n(128,151),n(126,155),n(123,160),n(120,166),n(116,171),n(112,177),n(107,183),n(102,188),n(100,191),n(95,195),n(90,199),n(86,203),n(82,206),n(80,209),n(75,213),n(73,213),n(70,216),n(67,219),n(64,221),n(61,223),n(60,225),n(62,226),n(65,225),n(67,226),n(74,226),n(77,227),n(85,229),n(91,230),n(99,231),n(108,232),n(116,233),n(125,233),n(134,234),n(145,233),n(153,232),n(160,233),n(170,234),n(177,235),n(179,236),n(186,237),n(193,238),n(198,239),n(200,237),n(202,239),n(204,238),n(206,234),n(205,230),n(202,222),n(197,216),n(192,207),n(186,198),n(179,189),n(174,183),n(170,178),n(164,171),n(161,168),n(154,160),n(148,155),n(143,150),n(138,148),n(136,148)]));this.Templates.push(new w("x",[n(87,142),n(89,145),n(91,148),n(93,151),n(96,155),n(98,157),n(100,160),n(102,162),n(106,167),n(108,169),n(110,171),n(115,177),n(119,183),n(123,189),n(127,193),n(129,196),n(133,200),n(137,206),n(140,209),n(143,212),n(146,215),n(151,220),n(153,222),n(155,223),n(157,225),n(158,223),n(157,218),n(155,211),n(154,208),n(152,200),n(150,189),n(148,179),n(147,170),n(147,158),n(147,148),n(147,141),n(147,136),n(144,135),n(142,137),n(140,139),n(135,145),n(131,152),n(124,163),n(116,177),n(108,191),n(100,206),n(94,217),n(91,222),n(89,225),n(87,226),n(87,224)]));this.Templates.push(new w("rectangle",[n(78,149),n(78,153),n(78,157),n(78,160),n(79,162),n(79,164),n(79,167),n(79,169),n(79,173),n(79,178),n(79,183),n(80,189),n(80,193),n(80,198),n(80,202),n(81,208),n(81,210),n(81,216),n(82,222),n(82,224),n(82,227),n(83,229),n(83,231),n(85,230),n(88,232),n(90,233),n(92,232),n(94,233),n(99,232),n(102,233),n(106,233),n(109,234),n(117,235),n(123,236),n(126,236),n(135,237),n(142,238),n(145,238),n(152,238),n(154,239),n(165,238),n(174,237),n(179,236),n(186,235),n(191,235),n(195,233),n(197,233),n(200,233),n(201,235),n(201,233),n(199,231),n(198,226),n(198,220),n(196,207),n(195,195),n(195,181),n(195,173),n(195,163),n(194,155),n(192,145),n(192,143),n(192,138),n(191,135),n(191,133),n(191,130),n(190,128),n(188,129),n(186,129),n(181,132),n(173,131),n(162,131),n(151,132),n(149,132),n(138,132),n(136,132),n(122,131),n(120,131),n(109,130),n(107,130),n(90,132),n(81,133),n(76,133)]));this.Templates.push(new w("circle",[n(127,141),n(124,140),n(120,139),n(118,139),n(116,139),n(111,140),n(109,141),n(104,144),n(100,147),n(96,152),n(93,157),n(90,163),n(87,169),n(85,175),n(83,181),n(82,190),n(82,195),n(83,200),n(84,205),n(88,213),n(91,216),n(96,219),n(103,222),n(108,224),n(111,224),n(120,224),n(133,223),n(142,222),n(152,218),n(160,214),n(167,210),n(173,204),n(178,198),n(179,196),n(182,188),n(182,177),n(178,167),n(170,150),n(163,138),n(152,130),n(143,129),n(140,131),n(129,136),n(126,139)]));this.Templates.push(new w("check",[n(91,185),n(93,185),n(95,185),n(97,185),n(100,188),n(102,189),n(104,190),n(106,193),n(108,195),n(110,198),n(112,201),n(114,204),n(115,207),n(117,210),n(118,212),n(120,214),n(121,217),n(122,219),n(123,222),n(124,224),n(126,226),n(127,229),n(129,231),n(130,233),n(129,231),n(129,228),n(129,226),n(129,224),n(129,221),n(129,218),n(129,212),n(129,208),n(130,198),n(132,189),n(134,182),n(137,173),n(143,164),n(147,157),n(151,151),n(155,144),n(161,137),n(165,131),n(171,122),n(174,118),n(176,114),n(177,112),n(177,114),n(175,116),n(173,118)]));this.Templates.push(new w("caret",[n(79,245),n(79,242),n(79,239),n(80,237),n(80,234),n(81,232),n(82,230),n(84,224),n(86,220),n(86,218),n(87,216),n(88,213),n(90,207),n(91,202),n(92,200),n(93,194),n(94,192),n(96,189),n(97,186),n(100,179),n(102,173),n(105,165),n(107,160),n(109,158),n(112,151),n(115,144),n(117,139),n(119,136),n(119,134),n(120,132),n(121,129),n(122,127),n(124,125),n(126,124),n(129,125),n(131,127),n(132,130),n(136,139),n(141,154),n(145,166),n(151,182),n(156,193),n(157,196),n(161,209),n(162,211),n(167,223),n(169,229),n(170,231),n(173,237),n(176,242),n(177,244),n(179,250),n(181,255),n(182,257)]));this.Templates.push(new w("zigzag",[n(307,216),n(333,186),n(356,215),n(375,186),n(399,216),n(418,186)]));this.Templates.push(new w("arrow",[n(68,222),n(70,220),n(73,218),n(75,217),n(77,215),n(80,213),n(82,212),n(84,210),n(87,209),n(89,208),n(92,206),n(95,204),n(101,201),n(106,198),n(112,194),n(118,191),n(124,187),n(127,186),n(132,183),n(138,181),n(141,180),n(146,178),n(154,173),n(159,171),n(161,170),n(166,167),n(168,167),n(171,166),n(174,164),n(177,162),n(180,160),n(182,158),n(183,156),n(181,154),n(178,153),n(171,153),n(164,153),n(160,153),n(150,154),n(147,155),n(141,157),n(137,158),n(135,158),n(137,158),n(140,157),n(143,156),n(151,154),n(160,152),n(170,149),n(179,147),n(185,145),n(192,144),n(196,144),n(198,144),n(200,144),n(201,147),n(199,149),n(194,157),n(191,160),n(186,167),n(180,176),n(177,179),n(171,187),n(169,189),n(165,194),n(164,196)]));this.Templates.push(new w("leftbracket",[n(140,124),n(138,123),n(135,122),n(133,123),n(130,123),n(128,124),n(125,125),n(122,124),n(120,124),n(118,124),n(116,125),n(113,125),n(111,125),n(108,124),n(106,125),n(104,125),n(102,124),n(100,123),n(98,123),n(95,124),n(93,123),n(90,124),n(88,124),n(85,125),n(83,126),n(81,127),n(81,129),n(82,131),n(82,134),n(83,138),n(84,141),n(84,144),n(85,148),n(85,151),n(86,156),n(86,160),n(86,164),n(86,168),n(87,171),n(87,175),n(87,179),n(87,182),n(87,186),n(88,188),n(88,195),n(88,198),n(88,201),n(88,207),n(89,211),n(89,213),n(89,217),n(89,222),n(88,225),n(88,229),n(88,231),n(88,233),n(88,235),n(89,237),n(89,240),n(89,242),n(91,241),n(94,241),n(96,240),n(98,239),n(105,240),n(109,240),n(113,239),n(116,240),n(121,239),n(130,240),n(136,237),n(139,237),n(144,238),n(151,237),n(157,236),n(159,237)]));this.Templates.push(new w("rightbracket",[n(112,138),n(112,136),n(115,136),n(118,137),n(120,136),n(123,136),n(125,136),n(128,136),n(131,136),n(134,135),n(137,135),n(140,134),n(143,133),n(145,132),n(147,132),n(149,132),n(152,132),n(153,134),n(154,137),n(155,141),n(156,144),n(157,152),n(158,161),n(160,170),n(162,182),n(164,192),n(166,200),n(167,209),n(168,214),n(168,216),n(169,221),n(169,223),n(169,228),n(169,231),n(166,233),n(164,234),n(161,235),n(155,236),n(147,235),n(140,233),n(131,233),n(124,233),n(117,235),n(114,238),n(112,238)]));this.Templates.push(new w("v",[n(89,164),n(90,162),n(92,162),n(94,164),n(95,166),n(96,169),n(97,171),n(99,175),n(101,178),n(103,182),n(106,189),n(108,194),n(111,199),n(114,204),n(117,209),n(119,214),n(122,218),n(124,222),n(126,225),n(128,228),n(130,229),n(133,233),n(134,236),n(136,239),n(138,240),n(139,242),n(140,244),n(142,242),n(142,240),n(142,237),n(143,235),n(143,233),n(145,229),n(146,226),n(148,217),n(149,208),n(149,205),n(151,196),n(151,193),n(153,182),n(155,172),n(157,165),n(159,160),n(162,155),n(164,150),n(165,148),n(166,146)]));this.Templates.push(new w("delete",[n(123,129),n(123,131),n(124,133),n(125,136),n(127,140),n(129,142),n(133,148),n(137,154),n(143,158),n(145,161),n(148,164),n(153,170),n(158,176),n(160,178),n(164,183),n(168,188),n(171,191),n(175,196),n(178,200),n(180,202),n(181,205),n(184,208),n(186,210),n(187,213),n(188,215),n(186,212),n(183,211),n(177,208),n(169,206),n(162,205),n(154,207),n(145,209),n(137,210),n(129,214),n(122,217),n(118,218),n(111,221),n(109,222),n(110,219),n(112,217),n(118,209),n(120,207),n(128,196),n(135,187),n(138,183),n(148,167),n(157,153),n(163,145),n(165,142),n(172,133),n(177,127),n(179,127),n(180,125)]));this.Templates.push(new w("star",[n(75,250),n(75,247),n(77,244),n(78,242),n(79,239),n(80,237),n(82,234),n(82,232),n(84,229),n(85,225),n(87,222),n(88,219),n(89,216),n(91,212),n(92,208),n(94,204),n(95,201),n(96,196),n(97,194),n(98,191),n(100,185),n(102,178),n(104,173),n(104,171),n(105,164),n(106,158),n(107,156),n(107,152),n(108,145),n(109,141),n(110,139),n(112,133),n(113,131),n(116,127),n(117,125),n(119,122),n(121,121),n(123,120),n(125,122),n(125,125),n(127,130),n(128,133),n(131,143),n(136,153),n(140,163),n(144,172),n(145,175),n(151,189),n(156,201),n(161,213),n(166,225),n(169,233),n(171,236),n(174,243),n(177,247),n(178,249),n(179,251),n(180,253),n(180,255),n(179,257),n(177,257),n(174,255),n(169,250),n(164,247),n(160,245),n(149,238),n(138,230),n(127,221),n(124,220),n(112,212),n(110,210),n(96,201),n(84,195),n(74,190),n(64,182),n(55,175),n(51,172),n(49,170),n(51,169),n(56,169),n(66,169),n(78,168),n(92,166),n(107,164),n(123,161),n(140,162),n(156,162),n(171,160),n(173,160),n(186,160),n(195,160),n(198,161),n(203,163),n(208,163),n(206,164),n(200,167),n(187,172),n(174,179),n(172,181),n(153,192),n(137,201),n(123,211),n(112,220),n(99,229),n(90,237),n(80,244),n(73,250),n(69,254),n(69,252)]));this.Templates.push(new w("pigtail",[n(81,219),n(84,218),n(86,220),n(88,220),n(90,220),n(92,219),n(95,220),n(97,219),n(99,220),n(102,218),n(105,217),n(107,216),n(110,216),n(113,214),n(116,212),n(118,210),n(121,208),n(124,205),n(126,202),n(129,199),n(132,196),n(136,191),n(139,187),n(142,182),n(144,179),n(146,174),n(148,170),n(149,168),n(151,162),n(152,160),n(152,157),n(152,155),n(152,151),n(152,149),n(152,146),n(149,142),n(148,139),n(145,137),n(141,135),n(139,135),n(134,136),n(130,140),n(128,142),n(126,145),n(122,150),n(119,158),n(117,163),n(115,170),n(114,175),n(117,184),n(120,190),n(125,199),n(129,203),n(133,208),n(138,213),n(145,215),n(155,218),n(164,219),n(166,219),n(177,219),n(182,218),n(192,216),n(196,213),n(199,212),n(201,211)]));this.Recognize=function(B){var x=+Infinity,A=0,C,z,E,y;B=g(B,c);C=o(B);B=k(B,-C);y=q(B);for(z=0;z<this.Templates.length;z++){var D=p(this.Templates[z].Vector,y);if(D<x){x=D;A=z}}return new j(this.Templates[A].Name,1/x)}}function g(G,z){var F=f(G)/(z-1),x=0,H=new Array(G[0]),B;for(B=1;B<G.length;B++){var E=e(G[B-1],G[B]);if((x+E)>=F){var C=G[B-1].X+((F-x)/E)*(G[B].X-G[B-1].X),A=G[B-1].Y+((F-x)/E)*(G[B].Y-G[B-1].Y),y=n(C,A);H[H.length]=y;G.splice(B,0,y);x=0}else{x+=E}}if(H.length==z-1){H[H.length]=n(G[G.length-1].X,G[G.length-1].Y)}return H}function o(x){var y=m(x);return Math.atan2(y.Y-x[0].Y,y.X-x[0].X)}function k(D,x){var B=m(D),E=Math.cos(x),C=Math.sin(x),F=[],z;for(z=0;z<D.length;z++){var A=(D[z].X-B.X)*E-(D[z].Y-B.Y)*C+B.X,y=(D[z].X-B.X)*C+(D[z].Y-B.Y)*E+B.Y;F[F.length]=n(A,y)}return F}function s(A,y){var E=a(A),D=[],x;for(x=0;x<A.length;x++){var C=A[x].X*(y/E.Width),z=A[x].Y*(y/E.Height);D[D.length]=n(C,z)}return D}function d(z,B){var D=m(z),C=[],x;for(x=0;x<z.length;x++){var A=z[x].X+B.X-D.X,y=z[x].Y+B.Y-D.Y;C[C.length]=n(A,y)}return C}function q(A){var z=0,x=[],y,B;for(y=0;y<A.length;y++){x[x.length]=A[y].X;x[x.length]=A[y].Y;z+=A[y].X*A[y].X+A[y].Y*A[y].Y}B=Math.sqrt(z);for(y=0;y<x.length;y++){x[y]/=B}return x}function p(C,B){var y=0,x=0,z,A;for(z=0;z<C.length;z+=2){y+=C[z]*B[z]+C[z+1]*B[z+1];x+=C[z]*B[z+1]-C[z+1]*B[z]}A=Math.atan(x/y);return Math.acos(y*Math.cos(A)+x*Math.sin(A))}function m(B){var z=0,C=0,A;for(A=0;A<B.length;A++){z+=B[A].X;C+=B[A].Y}z/=B.length;C/=B.length;return n(z,C)}function a(z){var x=+Infinity,B=-Infinity,C=+Infinity,A=-Infinity,y;for(y=0;y<z.length;y++){if(z[y].X<x){x=z[y].X}if(z[y].X>B){B=z[y].X}if(z[y].Y<C){C=z[y].Y}if(z[y].Y>A){A=z[y].Y}}return new b(x,C,B-x,A-C)}function f(y){var z=0,x;for(x=1;x<y.length;x++){z+=e(y[x-1],y[x])}return z}function e(A,z){var y=z.X-A.X,x=z.Y-A.Y;return Math.sqrt(y*y+x*x)}})(jQuery);